<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Project 1</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
      h3, text{
        font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif;
      }
      .gridlines .domain {
        display: none;
      }

      .gridlines line {
        stroke: rgb(195, 189, 189);
      }
     h3 {
      text-align: center;
      font-size: 30px;
     }
    
  

    </style>
  </head>
  <h3>Sentiments Rating for Tweets after Queen Elizabeth II's Death by Language</h3>
  <body>
    <svg
      id="queen"
      height="800"
      width="1200"
      style="background-color: white"
    ></svg>

    <script>
      const svg = d3.select("svg#queen");
      const margin = { top: 30, right: 10, bottom: 200, left: 100 };
      const width = svg.attr("width");
      const height = svg.attr("height");
      const chartWidth = width - margin.left - margin.right;
      const chartHeight = height - margin.top - margin.bottom;

      const languageScoreScale = d3
        .scaleLinear()
        .domain([-1, 1])
        .range([chartHeight, 0]);

      let chartArea = svg
        .append("g")
        .attr("id", "points")
        .attr("transform", `translate(${margin.left},${margin.top})`);
      let annotations = svg.append("g").attr("id", "annotations");
                

      const createCircle = (circleRad) => {};

      d3.csv("clean_final_v3.csv", d3.autotype).then((data) => {
        const languageScale = d3
          .scaleOrdinal()
          .domain(data, (d) => d.language_full)
          .range([
            "#fbb4ae",
            "#b3cde3",
            "#ccebc5",
            "#decbe4",
            "#999796",
            "#5CAC5F",
            "#e5d8bd",
            "#fddaec",
            "#DE95CF",
          ]);

        const circleRadScale = d3
          .scaleLog()
          .domain([1e-6, 34621])
          .range([0, 20]);

        const circleRadLinScale = d3
          .scaleLinear()
          .domain([0, 1])
          .range([0, 10]);

        // Languages (bottom axis)
        const languages = d3.map(data, (d) => d.language_full);
        const languageChartScale = d3
          .scaleBand()
          .domain(languages)
          .range([0, chartWidth])
          .padding(0.05);

        // Left axis
        let leftAxis = d3.axisLeft(languageScoreScale);
        let leftGridlines = d3
          .axisLeft(languageScoreScale)
          .tickSize(-chartWidth - 10)
          .tickFormat("");

        annotations
          .append("g")
          .attr("class", "axis")
          .attr("transform", `translate(${margin.left - 10},${margin.top})`)
          .call(leftAxis)
          .selectAll("text")
                    .style("text-anchor", "end")
                    .attr("font-size", 14);
                    
                    

        annotations
          .append("g")
          .attr("class", "y gridlines")
          .attr("transform", `translate(${margin.left - 10},${margin.top})`)
          .call(leftGridlines);

        //   Bottom axis
        let bottomAxis = d3.axisBottom();

        let bottomGridlines = d3.axisBottom(languageChartScale)
                    .tickSize(-chartHeight-10)
                    .tickFormat("");

        let bottomAxisG = annotations
          .append("g")
          .attr("class", "x axis")
          .attr(
            "transform",
            `translate(${margin.left},${chartHeight + margin.top + 10})`
          );
          
          
        annotations.append("g")
              .attr("class", "x gridlines")
             
              .attr('transform', `translate(${margin.left},${chartHeight+margin.top +10})`)
             
              .call(bottomGridlines);


        bottomAxis.scale(languageChartScale);
        bottomAxisG.transition()
                    .call(bottomAxis)
                    .selectAll("text")
                    .style("text-anchor", "end")
                    .attr("font-size", 16)
                    .attr("dx", "-.8em")
                    .attr("dy", ".15em")
                    .attr("transform", "rotate(-60)");

        // Circles (main data)
        chartArea
          .selectAll("circle")
          .data(data, (d) => d.score)
          .join("circle")
          .attr("class", "pop")
          .attr("r", (d) => circleRadScale(d.normalized))
          .attr("fill", (d) => languageScale(d.language_full))
          .attr("cx", (d) => languageChartScale(d.language_full)+19)
          .attr("cy", (d) => languageScoreScale(d.score));
      });
      // x axis label
      svg.append("text")
        .attr("class", "x label")
        .attr("text-anchor", "start")
        .attr("x", width/2)
        .attr("y", height-50)
        .attr("font-size", 23)
        .text("Language");

        // y axis label
      svg.append("text")
        .attr("class", "y label")
        .attr("text-anchor", "start")
        .attr('y', 15)
        .attr('dy', '1em')
        .attr('x', 0 - (height/2))
        .attr("font-size", 23)
        .attr("transform", "rotate(-90)")
        .text("Sentiment Score");

      


      chartArea.raise();
      
    </script>
    
  </body>
</html>
